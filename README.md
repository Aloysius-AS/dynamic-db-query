# Dynamic Database Query

<br/>

## Configuring the Project

In the root of the project, create knexfile.js. knexfile(sample).js is provided for reference.\
Update knexfile.js with the information of the database for the required environments (development, staging, production).

Then create .env file in root of the project. .env(sample) is provided for reference.
Update .env file.

- NODE_ENV: indicates which environment configuration (as specified in knexfile.js) to load for the database

<br/>

## Starting the Project

Run the following command.

For Production,

> npm start

&nbsp;

For Development, either command can be executed,

Without nodemon:

> npm run start:dev

With nodemon:

> npm run start:dev-nodemon

Note: .env needs to be configured.

<br/>

## Logs

Logs are written to physical files in the **logs** folder.

For Windows environment, the logs can be prettified with the following command.

> type \<log file> | pino-pretty -t SYS:standard > \<output file>

**app** folder stores the logs generated by the application.
**http-request-log** folder stores the logs generated by Express middleware.

<br/>

## Testing

1. In .env, change the following variable to the 'test' environment.

> NODE_ENV=test

2. In knexfile.js, update the database information in the test property.\

   It is recommended to use a different database name from Development. This is because
   the database would be seeded and deleted during execution of the tests.

3. Create the database with the name and other information specified in the above step.

4. Run test scripts with the following command.\

> npm test

<br/>

## Troubleshooting

### TimescaleDb

Error:

> function time_bucket(unknown, timestamp with time zone) does not exist

This is likely due to installing timescaleDb in specific Postgres schema.
We can install timescaleDb in specific schema via the following snippet.

> CREATE EXTENSION IF NOT EXISTS timescaledb WITH SCHEMA <schema_name>
